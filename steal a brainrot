-- STRONG PLAYER HIGHLIGHT + NAME ESP
-- LocalScript

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- SETTINGS
local HIGHLIGHT_COLOR = Color3.fromRGB(255, 0, 0)
local OUTLINE_COLOR = Color3.fromRGB(255, 255, 255)

-- Remove old ESP if exists
local function cleanup(character)
	for _, v in pairs(character:GetChildren()) do
		if v:IsA("Highlight") or v:IsA("BillboardGui") then
			v:Destroy()
		end
	end
end

-- Apply ESP
local function applyESP(player, character)
	if player == LocalPlayer then return end
	if not character then return end

	cleanup(character)

	-- Highlight
	local highlight = Instance.new("Highlight")
	highlight.Name = "PlayerESP"
	highlight.FillColor = HIGHLIGHT_COLOR
	highlight.FillTransparency = 0.5
	highlight.OutlineColor = OUTLINE_COLOR
	highlight.OutlineTransparency = 0
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	highlight.Adornee = character
	highlight.Parent = character

	-- Name above head
	local head = character:WaitForChild("Head", 5)
	if head then
		local billboard = Instance.new("BillboardGui")
		billboard.Name = "NameESP"
		billboard.Adornee = head
		billboard.Size = UDim2.new(0, 200, 0, 50)
		billboard.StudsOffset = Vector3.new(0, 3, 0)
		billboard.AlwaysOnTop = true
		billboard.Parent = head

		local text = Instance.new("TextLabel")
		text.Size = UDim2.new(1, 0, 1, 0)
		text.BackgroundTransparency = 1
		text.Text = player.Name
		text.TextColor3 = HIGHLIGHT_COLOR
		text.TextStrokeTransparency = 0
		text.TextStrokeColor3 = Color3.new(0, 0, 0)
		text.TextScaled = true
		text.Font = Enum.Font.GothamBold
		text.Parent = billboard
	end
end

-- Handle player
local function setupPlayer(player)
	player.CharacterAdded:Connect(function(character)
		task.wait(0.5)
		applyESP(player, character)
	end)

	if player.Character then
		applyESP(player, player.Character)
	end
end

-- Existing players
for _, player in ipairs(Players:GetPlayers()) do
	setupPlayer(player)
end

-- NEW players joining
Players.PlayerAdded:Connect(function(player)
	setupPlayer(player)
end)
